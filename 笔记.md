# 一、基本概念

1. 数据格式：

   - 表示单个时刻的数据，其 shape = [N, \*]，其中 N 是batch维度，\* 表示任意额外的维度
   - 表示多个时刻的数据，其 shape = [T, N, \*]，其中 T 是数据的时间维度， N 是batch维度，\* 表示任意额外的维度
2. 步进模式：单步模式(single-step)和多步模式(multi-step)。
   - 在单步模式下，数据使用`shape = [N, *]`的格式；而在多步模式下，数据使用`shape = [T, N, *]`的格式。模块在初始化时可以指定其使用的步进模式 step_mode，也可以在构建后直接进行修改。
   - shape = [T, N, *]的序列数据，通常需要手动做一个时间上的循环，将数据拆成T个shape = [N, *]的数据并逐步输入进去。
   - multi_step_forward提供了将 shape = [T, N, *] 的序列数据输入到单步模块进行逐步的前向传播的封装，直接将模块设置成多步模块，更为便捷。
   - 默认为单步。

3. 状态的保存和重置：状态会被保存在模块内部，初始化后，IF神经元层的 v 会被设置为0，首次给与输入后 v 会自动广播到与输入相同的 shape。若需要一个新的输入，则应该先清除神经元之前的状态，可以通过调用模块的 self.reset() 函数实现。可以通过调用 spikingjelly.activation_based.functional.reset_net 将整个网络中的所有有状态模块进行重置。
   - 若网络使用了有状态的模块，在训练和推理时，务必在处理完毕一个batch的数据后进行重置。

4. 传播模式：逐步传播(step-by-step)和逐层传播(layer-by-layer)，实际上只是计算顺序不同，它们的计算结果是完全相同。
   - 在使用梯度替代法训练时，通常推荐使用逐层传播。在正确构建网络的情况下，逐层传播的并行度更大，速度更快。
   - 在内存受限时使用逐步传播，例如ANN2SNN任务中需要用到非常大的 T。因为在逐层传播模式下，对无状态的层而言，真正的 batch size 是 TN 而不是 N，当 T 太大时内存消耗极大。


